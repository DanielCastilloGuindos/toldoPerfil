---
import ProductCard from "@/components/ProductCard.astro";
import ProductCardDB from "@/components/ProductCardDB.astro";

import { db, Customers, eq } from "astro:db";

let customersQuery = [];
let dbError = false;

try {
	customersQuery = await db
		.select()
		.from(Customers)
		.where(eq(Customers.category, "privateCustomer"));
} catch (e) {
	console.error("Error fetching private customers:", e);
	dbError = true;
	customersQuery = [];
}
---

<section
	id="privatecustomers"
	class="flex flex-col justify-center items-center w-full p-0 md:p-16 md:pt-0 bg-neutral-800 text-white"
>
	<div class="w-full md:max-w-5xl">
		<header
			class="w-full py-4 flex flex-col gap-y-6 justify-center items-center"
		>
			<h3 class="text-3xl font-bold text-center">Particulares</h3>
			<h4 class="text-sm text-gray-100 max-w-xs text-center">
				Asesoramos a nuestros clientes el tipo de toldo que le conviene
				en cada caso
			</h4>
		</header>

		<article
			class="py-4 grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-6 px-2 sm:px-0 w-full sm:max-w-6xl"
		>
			{
				!dbError ? (
					customersQuery.map(
						({
							customer_id,
							title,
							description,
							images,
							isVisible,
						}) => {
							if (!isVisible) return;
							let protrairPath = (images as string[])[0];
							return (
								<ProductCardDB
									id={customer_id}
									title={title}
									description="Haz click para ver mÃ¡s detalles"
									image={protrairPath}
									key={"db" + customer_id}
								/>
							);
						},
					)
				) : (
					<div class="col-span-1 sm:col-span-2 w-full text-center py-10 bg-neutral-700/50 rounded-lg border border-neutral-600">
						<p class="text-gray-300 font-medium">
							Contenido temporalmente no disponible
						</p>
						<p class="text-sm text-gray-500 mt-2">
							Estamos trabajando para restaurar el servicio.
						</p>
					</div>
				)
			}
		</article>
	</div>
</section>
